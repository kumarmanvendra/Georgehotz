FROM ubuntu:20.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && \
    apt-get install -y --no-install-recommends gcc-aarch64-linux-gnu make cmake pkg-config clang g++ ocl-icd-opencl-dev python python3.8 python3-pip python3-dev  && \
    rm -rf /var/lib/apt/lists/*

# This is done before the copy to cache this layer of dependencies
RUN pip3 install keystone-engine unicorn torch pytest pytest-xdist onnx onnx2torch opencv-python tabulate safetensors types-PyYAML cloudpickle numpy requests pillow tqdm networkx pyopencl PyYAML --extra-index-url https://download.pytorch.org/whl/cpu

WORKDIR /app

ADD . /app

RUN pip3 install -e '.[testing]'
